# 数据库
---
## 数据库设计——数据库应用系统开发总论
---

**重点**

* 数据库设计的六阶段
* 需求分析、概念设计、逻辑设计

**难点**

* 数据流图
* ER方法和ER模型
* 概念模型到关系模型的转化

#### 4.1 数据库设计概述

结构设计与行为设计相结合

![数据库设计](image\数据库设计.png)

特点

* 反复性
* 试探性
* 多阶段
* 技术、管理和基础数据相结合

**数据库设计策略**

自顶向下，逐步求精，分而治之。

**数据库设计六阶段**

![数据库设计六阶段](image\数据库设计六阶段.png)

1. 需求分析阶段
   * 准确了解与分析用户需求
   * 是整个设计过程的基础，最困难，最耗费时间的一步
2. 概念设计阶段
   * 是整个数据库设计的关键
   * 通过对用户需求进行综合、归纳与抽象，形成一个独立于DBMS的概念模型。
3. 逻辑结构设计阶段
   * 将概念结构转换为某个DBMS所支持的数据模型
   * 对其进行优化
4. 物理结构设计阶段
   * 为逻辑数据模型选取一个最适合应用环境的物理结构(包括存储结构和存取方法)
5. 数据库实施阶段
   * 运用DBMS提供的数据语言、工具及宿主语言，根据逻辑设计和物理设计的结果
     * 建立数据库
     * 编制与调试应用程序
     * 组织数据入库
     * 进行试运行
6. 数据库运行维护阶段
   * 数据库应用系统经过试运行后即可投入正式运行。
   * 在数据库系统运行过程中必须不断地对其进行评价、调整与修改。

#### 需求分析

* 任务： 收集资料、了解用户需求
* 调查、收集、分析四方面要求
  * 信息要求：数据库需存储的数据
  * 处理要求：指用户要求完成什么处理功能，对处理的响应时间有什么要求、处理方式等。
  * 安全性要求：用户对存放信息的安全保密要求
  * 完整性要求：指数据应满足怎样的约束条件
* 需求分析难点： 用户缺少计算机专业的知识，设计人员缺少领域知识，用户需求发生变化。
  * 解决方法： 持续、深入交流

需求分析步骤：

1. 现系统调查

2. 业务及需求分析

   **数据流图，数据字典**

3. 综合与调整
4. 编写需求报告

自顶向下的结构化分析方法(Structured Analysis, SA方法)

* 采用逐层分解的方式分析系统
* 用数据流图和 数据字典描述系统

**数据流图(Date Flow Diagram, DFD)**

是一种图形化的系统模型，描述了数据流动，存储，处理的逻辑关系。

![DFD的描述符号](image\DFD的描述符号.png)

DFD有分层表示，可以逐步展开数据流和功能细节。

![](image\DFD 分层表示.png)

分解原则：

* 分解后的软件成分有相对独立功能
* 一次分解不要加入过多细节
* 一般深度为3-5

**数据字典(Data Dictionary, DD)**

* 是对系统中数据的详细描述，是各类数据结构和属性的清单。
* 数据字典在需求分析阶段建立，在数据库设计过程中不断修改、充实、完善。
* 关于数据的数据-> 元数据
* 数据字典包含的内容

| 名称     |             意义             |
| -------- | :--------------------------: |
| 数据项   |        数据的最小单位        |
| 数据结构 |    若干数据项有意义的集合    |
| 数据流   | 表示某一处理过程的输入或输出 |
| 数据存储 |     处理过程中存取的数据     |
| 处理过程 |        该过程的功能等        |

![数据字典描述](image\数据字典描述.png)

需求分析书一般包含内容：

* 需求调查原始资料
* 数据边界、环境及数据内部关系
* 数据流及分析
* 数据字典

#### 概念设计

概念模型的优点： 

1. 语义表达能力丰富
2. 易于交流和理解
3. 易于修改和扩充
4. 易于向各种数据模型转换

##### 概念设计的方法

* 自顶向下： 进行需求分析
* 自底向上：设计概念结构

##### E-R 方法

设计步骤：

1. 抽象数据并设计局部视图

2. 集成局部视图，得到全局概念结构

   

![E-R图分析](image\E-R图分析.png)

数据抽象：

* 对需求分析阶段收集的数据进行分类组织，得到实体与属性。

> 实体： 一组具有某些共同特性和行为的对象可以抽象为实体。对象和实体之间是"is member of "的关系
>
> 属性： 对象类型的组成成分可以抽象为实体的属性。 组成成分与对象类型之间是"is part of "的关系。

抽象实体、属性三原则：

* 原子性原则： 实体需进一步描述，而属性则不能
* 依赖性原则： 属性单向依赖于某个实体
* 一致性： 一个实体由若干个属性组成，这些属性之间有着内在的关联性和一致性。

集成局部视图，得到全局概念结构：

步骤：

* 合并E-R图(消除冲突)

  * 冲突： 指各分E-R 图存在的不一致
    * 属性冲突： 取值范围、属性值类型
    * 命名冲突：同名异义，异名同义
    * 结构冲突：同一对象在不同应用中有不同的抽象、属性组成。同一联系在不同应用中呈现不同类型。

* 优化 (消除冗余)

  冗余数据： 破坏数据完整性

  冗余联系：增加数据库维护困难

策略

* 一次集成法、逐次集成法。



弱实体集： 指没有键属性的实体集

​	弱实体集的识别： 

	*  弱实体集依赖的强实体集称为识别实体。
	*  识别联系：识别实体与弱实体集之间的联系(必须是1：n联系)
	*  识别实体的主码+弱实体集的部分码->弱实体识别属性

强实体集：属性可以形成键的实体集

![弱实体集E-R图表示](image\E-R图表示.png)

#### 逻辑设计

* 逻辑设计的任务： 把概念设计阶段得到的基本E-R图转换未与选用DBMS所支持的数据模型相符合的逻辑结构。

![逻辑结构设计步骤](image\逻辑结构设计步骤.png)

E-R图向关系模型转换的任务：

(1) 实体转换为关系

(2)联系转换为关系

一个实体转换为一个关系模式，实体的属性就是关系的属性，实体的码就是关系的码。

转换规则：

* 1：1联系可以转换为一个独立的关系模式，也可以与任意一端所对应的关系模式合并。
* 1:n联系可以转换为一个独立的关系模式，也可以与n端所对应的关系模式合并。
* m:n联系转换为一个关系模式，关系的码是各实体的码的组合
* 三个or三个以上的实体间的多元联系转换为一个关系模式

弱实体集的转换：

作为其识别实体的属性：

* 当弱实体集只参与标识联系，并且属性较少时，可将弱实体集作为其依赖的强实体集的属性。

作为单独的实体集：

* 当弱实体集不仅仅参与标识联系或者属性较多时，作为实体。(需添加识别主体的主码)



**关系模式的优化** 

关系数据模型的优化通常以规范化理论为指导。

关系规范化-->确定数据依赖--> 确定所属范式，极小化处理，合并与分解。 

一般基于三范式。

**设计外模式**

目的： 1. 使用更符合用户习惯的别名

1. 保证系统安全性
2. 简化用户对系统的使用

DBMS 一般采用视图机制。

**物理设计**

数据库在物理设备上的存储结构与存取方法称为数据库的物理结构。

它依赖于 DBMS。

物理设计： 为逻辑模型选取一个适合的物理结构的过程。

* 确定数据的存储结构
* 设计数据的存取路径
  * 选取存取路径主要指确定如何建立索引。
    * 使用频繁的字段推荐建立索引。



